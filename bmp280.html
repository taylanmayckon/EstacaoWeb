<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DogAtmos - EmbarcaTech</title>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5;
            color: #333;
        }
        h1 {
            text-align: center;
        }

        .buttons-row {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }

        .button-style {
            font-size: 20px; 
            padding: 10px 30px; 
            margin: 10px; 
            border: none; 
            border-radius: 8px; 
            background: #4CAF50; 
            color: white;
        }

        .sensor-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .chart-container {
            flex: 2;
            min-width: 300px;
            max-width: 700px;
        }
        .chart-container canvas {
            width: 100% !important;
            height: 300px !important;
        }

        .sensor-info {
            flex: 1;
            min-width: 250px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .info-item, .input-group, .alert-status-container {
            background-color: #f8f9fa;
            padding: 10px 15px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }

        .info-item p {
            margin: 0;
            font-size: 1.2em;
            font-weight: 500;
        }
        .info-item span {
            font-weight: 400;
            color: #007bff;
        }

        .input-group label, .alert-status-container label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        .input-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .alert-indicator {
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            color: white;
            background-color: #4CAF50; 
            transition: background-color 0.3s ease, opacity 0.3s ease;
        }

        .alert-indicator.triggered {
            background-color: #f44336; 
            animation: blink 1.2s infinite ease-in-out;
        }

        @keyframes blink {
            50% { opacity: 0.7; }
        }

    </style>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>

    <h1>DogAtmos - EmbarcaTech</h1>

    <div class="buttons-row">
        <button class="button-style" onclick="window.location.href='/bmp280'">
            BMP280
        </button>
        <button class="button-style" onclick="window.location.href='/aht20'">
            AHT20
        </button>
    </div>

    <div class="main-content">        
        <hr>

        <div class="sensor-row">
            <div class="chart-container">
                <h2>BMP280 - Pressão</h2>
                <canvas id="BMP280_pressure_chart"></canvas>
            </div>
            <div class="sensor-info">
                <div class="info-item"><p>Valor Atual: <span id="current_BMP280_pressure">--</span> hPa</p></div>
                <div class="input-group"><label for="min_BMP280_pressure">Limite Mínimo:</label><input type="number" id="min_BMP280_pressure" placeholder="Ex: 1000"></div>
                <div class="input-group"><label for="max_BMP280_pressure">Limite Máximo:</label><input type="number" id="max_BMP280_pressure" placeholder="Ex: 1020"></div>
                <div class="input-group"><label for="offset_BMP280_pressure">Offset de Calibração:</label><input type="number" id="offset_BMP280_pressure" value="0"></div>
                <div class="alert-status-container">
                    <label>Status do Alerta:</label>
                    <div id="alert_BMP280_pressure" class="alert-indicator">NORMAL</div>
                </div>
            </div>
        </div>

        <div class="sensor-row">
            <div class="chart-container">
                <h2>BMP280 - Temperatura</h2>
                <canvas id="BMP280_temperature_chart"></canvas>
            </div>
            <div class="sensor-info">
                <div class="info-item"><p>Valor Atual: <span id="current_BMP280_temperature">--</span> °C</p></div>
                <div class="input-group"><label for="min_BMP280_temperature">Limite Mínimo:</label><input type="number" id="min_BMP280_temperature" placeholder="Ex: 10"></div>
                <div class="input-group"><label for="max_BMP280_temperature">Limite Máximo:</label><input type="number" id="max_BMP280_temperature" placeholder="Ex: 30"></div>
                <div class="input-group"><label for="offset_BMP280_temperature">Offset de Calibração:</label><input type="number" id="offset_BMP280_temperature" value="0"></div>
                 <div class="alert-status-container">
                    <label>Status do Alerta:</label>
                    <div id="alert_BMP280_temperature" class="alert-indicator">NORMAL</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function createChartConfig(label, unit, r, g, b) {
            return {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: label,
                        data: [],
                        borderColor: `rgba(${r}, ${g}, ${b}, 1)`,
                        backgroundColor: `rgba(${r}, ${g}, ${b}, 0.2)`,
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { title: { display: true, text: 'Tempo' } },
                        y: { title: { display: true, text: `${label} [${unit}]` }, beginAtZero: false }
                    },
                    animation: { duration: 500 }
                }
            };
        }

        const charts = {
            BMP280_pressure: new Chart(document.getElementById('BMP280_pressure_chart').getContext('2d'), createChartConfig('Pressão', 'hPa', 75, 192, 192)),
            BMP280_temperature: new Chart(document.getElementById('BMP280_temperature_chart').getContext('2d'), createChartConfig('Temperatura', '°C', 255, 159, 64))
        };

        function updateData() {
            const timestamp = new Date().toLocaleTimeString('pt-BR');
            
            // Substituir pelo fetch('/dados.json') real
            const data = {
                BMP280_pressure: 1012 + (Math.random() * 15 - 7.5),
                BMP280_temperature: 26 + (Math.random() * 10 - 3)
            };

            for (const sensorId in data) {
                const value = data[sensorId];

                document.getElementById(`current_${sensorId}`).textContent = value.toFixed(2);
                addDataToChart(charts[sensorId], timestamp, value);
                checkAlerts(sensorId, value);
            }
        }

        function checkAlerts(sensorId, currentValue) {
            const minInput = document.getElementById(`min_${sensorId}`);
            const maxInput = document.getElementById(`max_${sensorId}`);
            const alertIndicator = document.getElementById(`alert_${sensorId}`);

            const minLimit = parseFloat(minInput.value);
            const maxLimit = parseFloat(maxInput.value);

            let isAlertTriggered = false;

            if (!isNaN(maxLimit) && currentValue > maxLimit) {
                isAlertTriggered = true;
            }

            if (!isNaN(minLimit) && currentValue < minLimit) {
                isAlertTriggered = true;
            }

            if (isAlertTriggered) {
                alertIndicator.classList.add('triggered');
                alertIndicator.textContent = 'ALERTA!';
            } else {
                alertIndicator.classList.remove('triggered');
                alertIndicator.textContent = 'NORMAL';
            }
        }
        
        function addDataToChart(chart, label, newData) {
            const MAX_DATA_POINTS = 30;
            chart.data.labels.push(label);
            chart.data.datasets[0].data.push(newData);
            if (chart.data.labels.length > MAX_DATA_POINTS) {
                chart.data.labels.shift();
                chart.data.datasets[0].data.shift();
            }
            chart.update('none');
        }

        setInterval(updateData, 2000);
        document.addEventListener('DOMContentLoaded', updateData);

    </script>
</body>
</html>
